---
title: 쿠버네티스 네트워크 설정
description: 쿠버네티스(Kubernetes) 클러스터 구성을 위한 필수 네트워크 설정 가이드입니다. 마스터 및 워커 노드의 포트 요구사항, 호스트네임 및 MAC 주소 중복 주의사항, 그리고 ip, netstat 등 실무 및 CKA 시험에 자주 출현하는 네트워크 디버깅 명령어를 정리했습니다.
keywords:
  - 쿠버네티스 네트워크 설정
  - 마스터 노드 포트
  - 워커 노드 포트
  - 쿠버네티스 호스트 네임 중복
  - 쿠버네티스 맥주소 중복
---
---
## 쿠버네티스 네트워크 설정
### 모든 노드 공통

- 네트워크 인터페이스: 최소 1개 이상의 네트워크 인터페이스를 가져야한다.
- IP 주소: 노드가 가진 네트워크 인터페이스에 IP가 할당되어 있어야 한다.
- 고유한 식별자
	- Hostname: 클러스터 내에서 유일해야한다. (cf: 이건 proxmox에서도 그랬음 -> [Proxmox 호스트네임 주의점](../../../22-Proxmox/04-proxmox-cluster.md###주의점))
	- Mac 주소: 클러스터 내에서 유일해야한다.

:::info
- 위의 요구사항들을 보고 엥? 너무 당연한 얘기들 아닌가? 자동으로 되는거 아닌가? 라고 생각할 수 있다.
- 하지만, 가장 많이 겪는 오류 중 하나이다.
- 예를들어 VM을 Clone 하여 노드를 생성할 경우, MAC 주소나 Hostname이 중복되어 안되는 경우가 매우 많다. (매우 주의)
:::

---
## 포트 구성

![cluster-networking1](assets/cluster-networking.jpg)
### 마스터 노드

| **프로토콜** | **포트 범위**     | **프로세스/컴포넌트**           | **설명**                                                      |
| -------- | ------------- | ----------------------- | ----------------------------------------------------------- |
| TCP      | **6443**      | Kubernetes API Server   | 워커 노드, Kubectl, 외부 사용자 등 모든 요청이 들어오는 통로                     |
| TCP      | **2379-2380** | etcd server client API  | **2379:** 클라이언트 통신용**2380:** 다중 마스터 구성 시 etcd 노드 간 데이터 동기화용 |
| TCP      | **10250**     | Kubelet API             | 마스터 노드 자체의 Kubelet 통신용 (마스터에도 Kubelet 존재 가능)                |
| TCP      | **10259**     | kube-scheduler          | 스케줄러 동작 포트                                                  |
| TCP      | **10257**     | kube-controller-manager | 컨트롤러 매니저 동작 포트                                              |

### 워커 노드

|**프로토콜**|**포트 범위**|**프로세스/컴포넌트**|**설명**|
|---|---|---|---|
|TCP|**10250**|Kubelet API|마스터 노드(API Server)가 워커 노드의 상태를 확인하고 명령을 내릴 때 사용|
|TCP|**30000-32767**|NodePort Services|외부 사용자가 배포된 서비스(애플리케이션)에 접근하기 위해 예약된 포트 범위

:::tip
클러스터를 구성할 때 위 포트들이 열려있는지 확인해야하는 요소
1. 노드 자체 방화벽
2. `iptables` 규칙
3. (클라우드 환경일 경우) 보안 그룹
:::

---
## 알아두어야 할 네트워크 명령어

```bash
ip link
```

- 시스템에 존재하는 모든 네트워크 인터페이스(예: `eth0`, `docker0`, `cni0`)의 목록과 상태(UP/DOWN), MAC 주소를 확인하는 명령어

```bash
ip addr
```

- 각 네트워크 인터페이스에 할당된 IP 주소 정보를 확인하는 명령어

```bash
ip addr add 192.168.1.10/24 dev eth0
```

- `eth0` 인터페이스에 `192.168.1.10` IP 주소를 수동으로 할당하는 명령어
- 디버깅 할 때, 인터페이스에 IP 주소가 할당되어있지 않을 경우에 사용한다.

```bash
ip route
```

- 현재 설정된 라우팅 테이블을 확인한다. 패킷이 목적지로 가기 위해 어떤 인터페이스와 게이트웨이를 거치는지 파악할 때 사용한다.

```bash
ip route add 192.168.1.0/24 via 192.168.2.1
```

- `192.168.1.0/24` 대역으로 가는 패킷을 `192.168.2.1` 게이트웨이를 통해 보내도록 정적 경로(Static Route)를 추가하는 명령어
- 디버깅 할 때, 라우팅 테이블이 제대로 설정되어있지 않을 경우 이를 설정할 때 사용한다.

```bash
arp
```

- ARP 테이블을 확인합니다. 특정 IP 주소와 매핑된 물리적 MAC 주소를 확인할 때 사용한다.
	- ARP - IP 주소를 MAC 주소로 바꿔주는 프로토콜
- 디버깅 할 때, IP 주소와 MAC 주소가 맞지 않을 경우 이를 설정할 때 사용한다.

```bash
netstat -plnt
```

- 현재 서버에서 수신 대기 중(Listening)인 TCP 포트와 해당 프로그램을 확인한다.
    - `-p`: 프로그램(PID/이름) 표시
    - `-l`: Listening 상태만 표시
    - `-n`: 호스트명 대신 숫자로 표시 (IP:Port)
    - `-t`: TCP 프로토콜만 표시
- 쿠버네티스 필수 포트(6443, 10250 등)가 정상적으로 열려있는지 확인할 때 사용한다.

```bash
route
```

- 라우팅 테이블을 확인합니다 (`ip route`와 유사하지만 구형 명령어이며, `net-tools` 패키지에 포함됨).

```bash
cat /proc/sys/net/ipv4/ip_forward
```

- 리눅스 커널의 IP 포워딩 활성화 여부를 확인한다.
    - `1`: 활성화 (패킷을 다른 인터페이스로 전달 가능)
    - `0`: 비활성화
- 쿠버네티스 파드(Pod) 간 통신을 위해 반드시 `1`로 설정되어 있어야 합니다.
	- 이에 대한 내용 정리 -> [IP 포워딩 활성화](../../../15-Network/01-Switching-Routing-Gateway#활성-방법)

---
## 레퍼런스

- https://kubernetes.io/docs/reference/networking/ports-and-protocols/
- Udemy - Certified Kubernetes Administrator (CKA) with Practice Tests (Mumshad)